---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
source("function_helper.R")
```


# Parametros


## Variacion de N

En este caso quedan todos los parametros fijos con la excepcion del N.

```{r}
variacion_n <- expand.grid(
  c(100,200,500,1000, 10000), #N
  10, #cantidad de ideas
  3, #Cantidad de votos
  1, #Presencia de votos negativos (bool)
  0.5, #Proporciones del algoritmo de visualizacion
  '6-2' #Parametros de la distribucion beta
)
```

## Variacion de la cantidad de ideas

En este caso quedan todos los parametros fijos con la excepcion de la cantidad de ideas, k.

```{r}
variacion_k <- expand.grid(
  500, #N
  c(5,10,15), #cantidad de ideas
  3, #Cantidad de votos
  1, #Presencia de votos negativos (bool)
  0.5, #Proporciones del algoritmo de visualizacion
  '6-2' #Parametros de la distribucion beta
)
```

## Variacion de la cantidad de votos

Como siempre, quedan todos los parametros fijos y se varia unicamente la cantidad de votos

```{r}
variacion_votos <- expand.grid(
  500, #N
  10, #cantidad de ideas
  c(1,3,5), #Cantidad de votos
  1, #Presencia de votos negativos (bool)
  0.5, #Proporciones del algoritmo de visualizacion
  '6-2' #Parametros de la distribucion beta
)
```


## Variacion del tipo de votos

```{r}
variacion_tipo <- expand.grid(
  500, #N
  10, #cantidad de ideas
  3, #Cantidad de votos
  c(1,0), #Presencia de votos negativos (bool)
  0.5, #Proporciones del algoritmo de visualizacion
  '6-2' #Parametros de la distribucion beta
)
```

El tipo de votos no esta implementado dentro de la funcion `simulacion_plataforma` por lo que es necesario adaptarlo para lo que esta implementado. La mejor manera de hacerlo seria aprovechar los parametros de la distribucion beta. Siendo que esta distribucion controla la probabilidad de que ocurran votos positivos, si lo llevamos a 1 nos aseguramos que nunca ocurran votos negativos. Para eso podemos usar una distribucion $Beta(1,0)$. 

```{r}
rbeta(10, 1, 0)
```
De esta manera implementamos una modificacion sobre el dataframe alterando los parametros de la distribucion para que sean '1-0'

```{r}
variacion_tipo$Var6 <- c('6-2', '1-0')
```


## Variacion de algoritmo de visualizacion

```{r}
variacion_visualizacion <- expand.grid(
  500, #N
  10, #cantidad de ideas
  3, #Cantidad de votos
  1, #Presencia de votos negativos (bool)
  c(0, 0.25, 0.5, 0.75, 1), #Proporciones del algoritmo de visualizacion
  '6-2' #Parametros de la distribucion beta
)
```

## Variacion de distribucion beta

Se varian los parametros que controlan la distribucion beta

```{r}
variacion_beta <- expand.grid(
  500, #N
  10, #cantidad de ideas
  3, #Cantidad de votos
  1, #Presencia de votos negativos (bool)
  0.5, #Proporciones del algoritmo de visualizacion
  c('4-4', '6-2', '2-6') #Parametros de la distribucion beta
)
```

## Integracion

Para integrar todos los dataframes generados anteriormente en uno solo vamos a usar `rbind`. 

```{r}
parametros_simulacion_df <- rbind(
  variacion_n, 
  variacion_k,
  variacion_votos,
  variacion_tipo,
  variacion_visualizacion,
  variacion_beta
)
```

A continuacion es necesario cambiar los nombres de las columnas a algo mas representativo

```{r}
colnames(parametros_simulacion_df) <- c(
  'N',
  'cant_ideas',
  'cant_votos',
  'Negativos',
  'Algoritmo',
  'Beta'
)
```

Por ultimo tenemos que eliminar filas repetidas. 

```{r}
parametros_simulacion_df <- parametros_simulacion_df %>% distinct()
```

Asi finalmente quedan `r nrow(parametros_simulacion_df)` situaciones unicas.


```{r}
test <- pmap(parametros_simulacion_df,
     ~ simulacion_plataforma(
      list = list(
            'n' = c(..1/2, ..1/2),
            'means' = list(rep(1,3), rep(-1,3)),
            'cov_mat' = list(diag(3), diag(3))
          ),
      beta = ..6,
      votos_totales = ..3,
      k = ..2,
      prop = ..5,
      k_method = 'B'
        )
     )
```

